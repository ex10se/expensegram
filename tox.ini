[tox]
skipsdist=True
envlist =
    py39, flake8
isolated_build = True
changedir=app

[gh-actions]
python =
    3.9: py39, flake8

[flake8]
i-control-code = true
max-arguments = 10
max-import-from-members = 15
max-imports = 15
max-line-complexity = 40
max-line-length = 120
max-local-variables = 10
max-methods = 10
max-module-expressions = 10
max-module-members = 10
max-string-usages = 10
nested-classes-whitelist = Config
statistics = true
count = true
disable-noqa = false

[testenv:flake8]
commands =
    flake8 ./
exclude = migrations,.tox,venv
deps =
    -r requirements.txt

[testenv]
passenv = POSTGRES_*
allowlist_externals=*
commands =
    python manage.py makemigrations --check
    coverage erase
    coverage run manage.py test --keepdb -v=3
    coverage report -m --skip-covered --omit .tox/*,manage.py --fail-under=80

envdir = {toxworkdir}/venvs/{envname}
setenv =
       DJANGO_SETTINGS_MODULE=config.settings
       PYTHONDONTWRITEBYTECODE=1
deps =
    -r requirements.txt
